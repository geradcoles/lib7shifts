#!/usr/bin/env python3
"""
usage: 7shifts2sqlite [options] <command> [<args>...]

options:
    -h --help         Show this screen
    -v --version      Show version information
    -d --debug        Enable debug logging (low-level)

commands:
    company     list and sync company data to sqlite
    department  list and sync department data to sqlite
    location    list and sync location data to sqlite
    role        list and sync role data to sqlite
    shift       list and sync shift data to sqlite
    time_punch  list and sync time punch data to sqlite
    user        list and sync user data to sqlite
    wage        list and sync user wages to sqlite
    help        show this screen

For most commands, you will also need to provide the 7shifts API key with an
environment variable called API_KEY_7SHIFTS for authenticaton with the 7shifts
API.

"""
from docopt import docopt
import sys
import logging
import importlib

def main(**args):
    cmd = args['<command>']
    argv = [cmd] + args['<args>']
    if cmd in 'company department location role shift time_punch user wage'.split():
        module = importlib.import_module('lib7shifts.cmd.{}'.format(cmd))
        module.main(**docopt(module.__doc__, argv=argv))
    elif cmd == 'help':
        print(__doc__)
    else:
        print("command {} is not valid".format(cmd))
    return 0

if __name__ == '__main__':
    args = docopt(__doc__, version='7shifts2sqlite 0.1', options_first=True)
    logging.basicConfig()
    if args['--debug']:
        logging.getLogger().setLevel(logging.DEBUG)
    else:
        logging.getLogger('lib7shifts').setLevel(logging.INFO)
    sys.exit(main(**args))
